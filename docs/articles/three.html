<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Clustering • ScatMatch</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Clustering">
<meta property="og:description" content="ScatMatch">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ScatMatch</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dbca-wa/ScatMatch/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="three_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Clustering</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dbca-wa/ScatMatch/blob/master/vignettes/three.Rmd"><code>vignettes/three.Rmd</code></a></small>
      <div class="hidden name"><code>three.Rmd</code></div>

    </div>

    
    
<p><img src="plots/scatmatch_logo.png"></p>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>Clustering is about finding similarities between samples so that they can be grouped which, in essence differentiates individuals within the data. The functions here will use hierarchical clustering methods on a calculated mismatch scores.</p>
</div>
<div id="finding-dissimilarities" class="section level2">
<h2 class="hasAnchor">
<a href="#finding-dissimilarities" class="anchor"></a>Finding dissimilarities</h2>
<p>The function below creates and stores a lot of data which is why you need to assign it to an object. The list object that it creates, stores among other data, mismatch scores and dissimilarity matrices.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create dissimilarities and store in an object</span>
<span class="va">dis_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dissimilarity.html">dissimilarity</a></span><span class="op">(</span>filtered_alleles <span class="op">=</span> <span class="st">"numerical_alleles_filtered_at0.8_mt0.2.csv"</span>,
                          errors <span class="op">=</span> <span class="st">"sample_error_results.csv"</span><span class="op">)</span></code></pre></div>
<p>Note that the filtered alleles data input is the final dataset that was created in the last article.</p>
</div>
<div id="visualisation-for-h" class="section level2">
<h2 class="hasAnchor">
<a href="#visualisation-for-h" class="anchor"></a>Visualisation for (h)</h2>
<p>The task at hand now is to determine a height (h) at which to “cut” the data or define the maximum number of allele differences allowed to allocate samples as the same individual. This makes the most sense when you look at the dendrogram plot. The height will determine how many groups are created from the data and thereby how many individuals there in the sampling.</p>
<p>The code section below will generate a dendrogram, an elbow plot, a histogram of mismatches, a heat map and a heat map of correlations. The heat maps are plotly objects which enable the user to interrogate the plot using the mouse cursor on the html outputs. These are all saved to the <code>results/cluster/</code> directory.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create some visualisations to determine (h)</span>
<span class="fu"><a href="../reference/dendro_plot.html">dendro_plot</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="va">dis_list</span><span class="op">)</span>
<span class="fu"><a href="../reference/elbow_plot.html">elbow_plot</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="va">dis_list</span>, maxh <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
<span class="fu"><a href="../reference/freq_hist.html">freq_hist</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="va">dis_list</span>, bins <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>
<span class="fu"><a href="../reference/heat_plot.html">heat_plot</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="va">dis_list</span><span class="op">)</span>
<span class="fu"><a href="../reference/heat_cor_plot.html">heat_cor_plot</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="va">dis_list</span><span class="op">)</span></code></pre></div>
<p>Note the maxh or maximum height (h) parameter for the elbow plot will make a longer x-axis but most plots will stabilise with a value of 10 (default). The bins parameter in the the frequency histogram determines the number of bins with which to display the data.</p>
<p>Another way of visualising is to generate histograms of the within group and between groups mismatches at various values of (h). Overlap between the distributions can indicate misassignment of group inclusion. These plots can be thought of as genetic distance plots. In the function to follow:</p>
<ul>
<li><p>lt - is the lower percentile of the “between” groups distribution and in the plots is represented by a blue dashed line.</p></li>
<li><p>ut - is the upper percentile of the “within” group distribution and in the plots is represented by a red dashed line.</p></li>
<li><p>bins - is how many bins to split the data into for the histograms. Ensure that it is the same as used for the frequency histogram featured above. This will make comparison between the two easy.</p></li>
</ul>
<p>The area between these two values is the overlap feature space and by running many simulations, the probability of distributions overlapping here determines the misassignment probability. The function defaults to the lt and ut values as below and is supported in the literature.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># misassignment plots and </span>
<span class="fu"><a href="../reference/misassign.html">misassign</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="va">dis_list</span>, maxh <span class="op">=</span> <span class="fl">10</span>, lt <span class="op">=</span> <span class="fl">0.005</span>, ut <span class="op">=</span> <span class="fl">0.995</span><span class="op">)</span></code></pre></div>
<p>The (h) value is captured in the file name of the plot. A csv file, <strong>misassignment_table.csv</strong>, is also saved which summarises these values at each (h).</p>
</div>
<div id="selecting-h" class="section level2">
<h2 class="hasAnchor">
<a href="#selecting-h" class="anchor"></a>Selecting (h)</h2>
<p>The elbow graph, heat map and misassignment graph are designed to help users identify the most likely (h). These graphs may not agree on a specify value and it is up to the user to pick this value. The choice of (h) depends on quality of the data and how conservative the user is in selecting (h). For instance, the user may choose to be more stringent if the data is very good quality and the error rate between replicates is low. However, if the data quality is not great i.e.  incomplete, high error rate etc, the user may want to adopt a more conservative choice knowing that he/she is likely to underestimate the true number of individuals. On the other hand, being too stringent may over estimate the true number by over splitting samples that belong to the same individual. In addition, the user may want to try different filter settings for both loci and individual genotypes to see if the grouping would change with different settings. This final decision should be accompanied by sexing results (to be updated) and the metadata to see if the grouping makes biological sense. The decision of choosing the most likely (h) for each type of graph is described below.</p>
<div id="elbow-graph" class="section level3">
<h3 class="hasAnchor">
<a href="#elbow-graph" class="anchor"></a>Elbow graph</h3>
<p>To determine a suitable (h), the user needs to look for the largest drop of group number as well as the value when the graph starts to flatten out. For the example below, a) shows a mismatch threshold of 2 would be a suitable value to select. However, with some data such as b) where the graph doesn’t show a clear drop. Thresholds of 3, 4, and 5 are all potential. You would need other types of graphs to make the decision.</p>
<p><img src="plots/elbow.png"></p>
</div>
<div id="heat-maps" class="section level3">
<h3 class="hasAnchor">
<a href="#heat-maps" class="anchor"></a>Heat maps</h3>
<p>In the interactive version of the heat map, you can zoom in to the area of interest by dragging a box around the area. You can hover the mouse over the edge of each deep blue coloured box to inspect how many allele differences between inside and outside the box. Try a few boxes, especially those that are large in size, then compare them with more distinct smaller boxes to get an idea of what would be a potential (h).</p>
<p><img src="plots/heatmap.png"></p>
</div>
<div id="misassignment-graphs" class="section level3">
<h3 class="hasAnchor">
<a href="#misassignment-graphs" class="anchor"></a>Misassignment graphs</h3>
<p>The misassignment graph plots frequency of allelic differences within and between groups assigned by selected (h). The graph assumes allelic differences between groups to follow a binomial distribution (blue). Any allelic differences falling outside the distribution are likely to be caused by other means such genotyping errors or variation between samples from the same individual (red). At each (h), the graph will indicate how many groups or individuals are detected. This number is the same number as shown in the elbow graph. The probability of misassignment is also calculated which can be converted into the percentage of error.</p>
<p>For example, the probability of assigning samples to a wrong group is 0.006% for graph a) compared to a smaller number, 0.000005% for graph b). The maximum suggested percentage is 0.5%.</p>
<p>Overlap of the upper 0.995 percentile (red dashed line) and lower 0.005 percentile (blue dashed line) suggest the possibility of misassigning samples to between and within group distributions. The location of the overlap suggests which distribution the samples will likely to misassign to. For example, if the overlap falls in the within group distribution (red), the samples from the between group distribution (blue) are likely to be misassigned to the within group distribution (red). From the example of the graph below, the most likely (h) would be 4 because a clear separation between within (red) and between (blue) distributions.</p>
<p><img src="plots/misassignment.png"></p>
</div>
</div>
<div id="create-the-groups" class="section level2">
<h2 class="hasAnchor">
<a href="#create-the-groups" class="anchor"></a>Create the groups</h2>
<p>After looking at all of the plots, an (h) value should be apparent and it is now time to apply it to the data and create some groups. Make sure you adjust (h) to your value.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create groups</span>
<span class="fu"><a href="../reference/majorities.html">majorities</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="va">dis_list</span>, 
           h <span class="op">=</span> <span class="fl">4</span>, errors <span class="op">=</span> <span class="st">"sample_error_results.csv"</span><span class="op">)</span></code></pre></div>
<p>This will create 2 new csv datasets in <code>results/cluster/</code>:</p>
<ul>
<li><p><strong>hclust_numerical_mismatch_h4_group_majorities_and_ties.csv</strong> - this data is organised by group, and shows the sample membership, the numerical alleles, majority vote of the alleles, whether there were any ties in the vote and average amplification rate.</p></li>
<li><p><strong>hclust_numerical_mismatch_h4_withGroups.csv</strong> - this is just the numerical allele data with groups assigned.</p></li>
</ul>
<p>Note that the (h) value used to create the cut forms part of the file names to avoid confusion if multiple runs are undertaken.</p>
<p>Lastly, to aid visualisation of allele differences within each group, colour formatted html tables can be created by running the function below. This will save a file called <strong>majorities_table.html</strong> in the <code>results/cluster/</code> directory.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># majorities html scrollable table</span>
<span class="fu"><a href="../reference/majorities_html.html">majorities_html</a></span><span class="op">(</span>majorities_csv <span class="op">=</span> <span class="st">"hclust_numerical_mismatch_h4_group_majorities_and_ties.csv"</span><span class="op">)</span></code></pre></div>
<p>That completes the clustering work. The next article, <em>Summaries</em>, shows how to make a map linking the samples to your metadata and some other summary data.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Bart Huntley.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
