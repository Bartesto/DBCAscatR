<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Clustering • ScatMatch</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Clustering">
<meta property="og:description" content="ScatMatch">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ScatMatch</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bartesto/ScatMatch/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="three_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Clustering</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bartesto/ScatMatch/blob/master/vignettes/three.Rmd"><code>vignettes/three.Rmd</code></a></small>
      <div class="hidden name"><code>three.Rmd</code></div>

    </div>

    
    
<p><img src="plots/scatmatch_logo.png"></p>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>Clustering is about finding similarities between samples so that they can be grouped which in essence differentiates individuals within the data. The functions here will use hierarchical clustering methods on a calculated mismatch scores.</p>
</div>
<div id="finding-dissimilarities" class="section level2">
<h2 class="hasAnchor">
<a href="#finding-dissimilarities" class="anchor"></a>Finding dissimilarities</h2>
<p>The function below creates and stores a lot of data which is why you need to assign it to an object. The list object that it creates, stores among other data, mismatch scores and dissimilarity matrices. Depending on how large your raw data is, the function can take a while to run. To give some indication of progress it will print to screen which mismatch score it is calculating from the total number of possible sample combinations.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create dissimilarities and store in an object</span>
<span class="va">dis_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dissimilarity.html">dissimilarity</a></span><span class="op">(</span>filtered_alleles <span class="op">=</span> <span class="st">"numerical_alleles_filtered_at0.8_mt0.2.csv"</span>,
                          errors <span class="op">=</span> <span class="st">"sample_error_results.csv"</span><span class="op">)</span></code></pre></div>
<p>Note that the filtered alleles data input is the final dataset that was created in the last article.</p>
</div>
<div id="visualisation-for-h" class="section level2">
<h2 class="hasAnchor">
<a href="#visualisation-for-h" class="anchor"></a>Visualisation for (h)</h2>
<p>The task at hand now is to determine a height (h) at which to “cut” the data. This makes the most sense when you look at the dendrogram plot. The height will determine how many groups are created from the data and thereby how many individuals there in the sampling.</p>
<p>The code section below will generate a dendrogram, an elbow plot, a histogram of mismatches, a heat map and a heat map of correlations. The heat maps are plotly objects which enable the user to interrogate the plot using the mouse cursor on the html outputs. These are all saved to the <code>results/cluster/</code> directory.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create some visualisations to determine (h)</span>
<span class="fu"><a href="../reference/dendro_plot.html">dendro_plot</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="va">dis_list</span><span class="op">)</span>
<span class="fu"><a href="../reference/elbow_plot.html">elbow_plot</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="va">dis_list</span>, maxh <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
<span class="fu"><a href="../reference/freq_hist.html">freq_hist</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="va">dis_list</span><span class="op">)</span>
<span class="fu"><a href="../reference/heat_plot.html">heat_plot</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="va">dis_list</span><span class="op">)</span>
<span class="fu"><a href="../reference/heat_cor_plot.html">heat_cor_plot</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="va">dis_list</span><span class="op">)</span></code></pre></div>
<p>Note the only parameter to tweak is the maxh or maximum height (h) for the elbow plot. Larger values will make a longer x-axis but most plots will stabilise with a value of 10 (default).</p>
<p>Another way of visualising is to generate histograms of the “within” group and “between” groups mismatches at various values of (h). Overlap between the distributions can indicate misassignment of group inclusion. These plots can be thought of as genetic distance plots. In the function to follow:</p>
<ul>
<li><p>lt - is the lower percentile of the “between” groups distribution and in the plots is represented by a blue dashed line.</p></li>
<li><p>ut - is the upper percentile of the “within” group distribution and in the plots is represented by a red dashed line.</p></li>
</ul>
<p>The area between these two values is the overlap feature space and by running many simulations the probability of distributions overlapping here determines the misassignment probability.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># misassignment plots and </span>
<span class="fu"><a href="../reference/misassign.html">misassign</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="va">dis_list</span>, maxh <span class="op">=</span> <span class="fl">10</span>, lt <span class="op">=</span> <span class="fl">0.005</span>, ut <span class="op">=</span> <span class="fl">0.995</span><span class="op">)</span></code></pre></div>
<p>The function defaults to the lt and ut values as above and is supported in the literature. An example of a plot.</p>
<p><img src="plots/gdistance.png"></p>
<p>The plots indicate how many individuals and the probability of misassignment at the given (h). The (h) value is captured in the file name of the plot. A csv file, <strong>misassignment_table.csv</strong>, is also saved which summarises these values at each (h).</p>
</div>
<div id="create-the-groups" class="section level2">
<h2 class="hasAnchor">
<a href="#create-the-groups" class="anchor"></a>Create the groups</h2>
<p>After looking at all of the plots an (h) value should be apparent and its now time to apply it to the data and create some groups. Make sure you adjust (h) to your value.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create groups</span>
<span class="fu"><a href="../reference/majorities.html">majorities</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="va">dis_list</span>, 
           h <span class="op">=</span> <span class="fl">4</span>, 
           filtered_alleles <span class="op">=</span> <span class="st">"numerical_alleles_filtered_at0.8_mt0.2.csv"</span>,
           errors <span class="op">=</span> <span class="st">"sample_error_results.csv"</span><span class="op">)</span></code></pre></div>
<p>This will create 2 new csv datasets in <code>results/cluster/</code>:</p>
<ul>
<li><p><strong>hclust_numerical_mismatch_h4_group_majorities_and_ties.csv</strong> - this data is organised by group, and shows the sample membership, the numerical alleles, majority vote of the alleles, whether there were any ties in the vote and average amplification rate.</p></li>
<li><p><strong>hclust_numerical_mismatch_h4_withGroups.csv</strong> - this is just the numerical allele data with groups assigned.</p></li>
</ul>
<p>Note that the (h) value used to create the cut forms part of the file names to avoid confusion if multiple runs are undertaken.</p>
<p>Lastly, because it’s nicer to look at colour formatted html tables instead of csv files, running the function below will make a <strong>majorities_table.html</strong> saved to the <code>results/cluster/</code> directory.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># majorities html scrollable table</span>
<span class="fu"><a href="../reference/majorities_html.html">majorities_html</a></span><span class="op">(</span>majorities_csv <span class="op">=</span> <span class="st">"hclust_numerical_mismatch_h4_group_majorities_and_ties.csv"</span><span class="op">)</span></code></pre></div>
<p>That completes the clustering work. The next article, <em>Summaries</em>, shows how to make a map linking the samples to your metadata and some other summary data.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Bart Huntley.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
